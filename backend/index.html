<!DOCTYPE html>
<html>
  <script>
    function getLastUserId() {
      return new Promise((resolve, reject) => {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/get_last_user_id", true);
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const userId = parseInt(xhr.responseText);
            resolve(userId);
          }
        };
        xhr.onerror = function() {
          reject(new Error("Request failed"));
        };
        xhr.send();
      });
    }

    async function readAddressesFile() {
      try {
        const response = await fetch("./adresses.txt");
    
        if (!response.ok) {
          console.error("‚ùå Fichier adresses.txt introuvable (code:", response.status, ")");
          return "";
        }
        const text = await response.text();
    
        if (text.trim().length > 0) {
          return text;
        } else {
          console.warn("‚ö†Ô∏è Fichier adresses.txt est vide.");
          return "";
        }
      } catch (error) {
        console.error("üö® Erreur lors de la lecture du fichier :", error);
        return "";
      }
    }

    // Fonction pour g√©n√©rer du SQL compatible PostgreSQL/Neon
    async function generateNeonSQL() {
      showPopup("‚è≥ G√©n√©ration du SQL PostgreSQL pour Neon...");
      
      try {
        const userCount = parseInt(document.getElementById('neonUserCount').value) || 50;
        const imageCount = parseInt(document.getElementById('neonImageCount').value) || 5;
        const country = document.getElementById('neonCountry').value;
        const includeTables = document.getElementById('includeTables').checked;
        const includeData = document.getElementById('includeData').checked;

        // Lire les adresses
        const addressesData = await readAddressesFile();
        const addressesLines = addressesData.split('\n').filter(line => line.trim().length > 0);

        if (addressesLines.length === 0) {
          throw new Error("Le fichier adresses.txt est vide ou introuvable");
        }

        let sqlContent = `-- üöÄ Script SQL g√©n√©r√© pour Neon.tech (PostgreSQL)
-- üìÖ G√©n√©r√© le: ${new Date().toLocaleString()}
-- üë• Utilisateurs: ${userCount} | üñºÔ∏è Images: ${imageCount} par utilisateur
-- üåç Pays: ${country}

`;

        // Section cr√©ation des tables
        if (includeTables) {
          sqlContent += `-- =============================================
-- CR√âATION DES TABLES
-- =============================================

-- Table des utilisateurs
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    username VARCHAR(25) UNIQUE,
    email VARCHAR(255) UNIQUE,
    password VARCHAR(255) NOT NULL DEFAULT '',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    gender VARCHAR(20),
    looking VARCHAR(20),
    birthdate DATE,
    biography TEXT,
    tags TEXT,
    address VARCHAR(255),
    city VARCHAR(255),
    country VARCHAR(255),
    postal_code VARCHAR(50),
    phone VARCHAR(255),
    status TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    lat VARCHAR(30) DEFAULT '0',
    lng VARCHAR(30) DEFAULT '0',
    vkey VARCHAR(255) DEFAULT '',
    rkey VARCHAR(255),
    verified BOOLEAN DEFAULT false,
    google_id VARCHAR(50),
    reports INTEGER DEFAULT 0
);

-- Table des images
CREATE TABLE IF NOT EXISTS images (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    name VARCHAR(255) NOT NULL,
    profile BOOLEAN DEFAULT false,
    cover BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table des matches
CREATE TABLE IF NOT EXISTS matches (
    id SERIAL PRIMARY KEY,
    matcher INTEGER REFERENCES users(id),
    matched INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table de l'historique des visites
CREATE TABLE IF NOT EXISTS history (
    id SERIAL PRIMARY KEY,
    visitor INTEGER REFERENCES users(id),
    visited INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table des utilisateurs bloqu√©s
CREATE TABLE IF NOT EXISTS blocked (
    id SERIAL PRIMARY KEY,
    blocker INTEGER REFERENCES users(id),
    blocked INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table des conversations
CREATE TABLE IF NOT EXISTS conversations (
    id_conversation SERIAL PRIMARY KEY,
    id_user1 INTEGER REFERENCES users(id),
    id_user2 INTEGER REFERENCES users(id),
    last_update TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    allowed BOOLEAN DEFAULT true,
    last_msg INTEGER
);

-- Table des messages
CREATE TABLE IF NOT EXISTS chat (
    id SERIAL PRIMARY KEY,
    id_conversation INTEGER REFERENCES conversations(id_conversation),
    id_from INTEGER REFERENCES users(id),
    message VARCHAR(2048) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_read BOOLEAN DEFAULT false
);

-- Table des notifications
CREATE TABLE IF NOT EXISTS notifications (
    id SERIAL PRIMARY KEY,
    type VARCHAR(20) NOT NULL,
    id_from INTEGER REFERENCES users(id),
    id_to INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_read BOOLEAN DEFAULT false,
    id_conversation INTEGER DEFAULT -1
);

-- Table des tags
CREATE TABLE IF NOT EXISTS tags (
    id SERIAL PRIMARY KEY,
    value VARCHAR(100) UNIQUE
);

`;
        }

        // Section insertion des donn√©es
        if (includeData) {
          sqlContent += `-- =============================================
-- INSERTION DES DONN√âES
-- =============================================

`;
          
          // G√©n√©ration des utilisateurs
          const salt = dcodeIO.bcrypt.genSaltSync(10);
          const hashedPassword = dcodeIO.bcrypt.hashSync('Motdepasse@123', salt);
          
          const defaultTags = ['Ecole-42-Paris', 'Validate-at-125', 'RNCP-5', 'RNCP-7', 'Development', 'Front-end', 'Back-end', 'Sports', 'Cinema', 'Music', 'Vegan', 'Geek', 'Piercing', 'Tattoos'];
          const defaultBiography = [
            'je suis timide', 'j aime la techno', 'Perdu mais aimant', 'J aime le tennis de table', 
            'Tendre, je cherche une relation serieuse', 'Ici pour vous faire rever', 'Je cherche mon ame soeur',
            'je suis bavard', 'j adore la musique pop', 'je suis un peu fou', 'je suis un peu folle',
            'l amour est mon essentiel', 'j aime la vie', 'rugbymen et le physique qui va avec',
            'je suis un rockeur', 'fan de johnny hallyday', 'j aime les danses de salon', 'je suis loyale',
            'je suis fidele','je suis honnete', 'je suis sincere', 'je suis franc', 'fidele en amour et en amitie'
          ];

          function getRandomTags() {
            const shuffled = [...defaultTags].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 4).join(', ');
          }

          function getRandomBiography() {
            const shuffled = [...defaultBiography].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 3).join(', ');
          }

          function generatePhoneNumber() {
            const firstDigit = '0';
            const secondDigit = (Math.floor(Math.random() * 9) + 1).toString();
            const randomDigits = Array.from({ length: 8 }, () => Math.floor(Math.random() * 10)).join('');
            return firstDigit + secondDigit + randomDigits;
          }

          function cleanString(input) {
            return input.replace(/[^\w\s]/gi, '');
          }

          // Insertion des utilisateurs
          sqlContent += `-- üë• INSERTION DES UTILISATEURS
INSERT INTO users (first_name, last_name, username, email, password, created_at, gender, looking, birthdate, biography, tags, address, city, country, postal_code, phone, status, lat, lng, vkey, verified, reports) VALUES
`;

          const uniqueUsernames = new Set();
          const users = [];

          for (let i = 1; i <= userCount; i++) {
            let firstName, lastName, username;
            
            do {
              firstName = cleanString(faker.name.firstName());
              lastName = cleanString(faker.name.lastName());
            } while (!(/^[a-zA-Z \-]+$/).test(firstName) || !(/^[a-zA-Z \-]+$/).test(lastName));
            
            do {
              username = cleanString(faker.internet.userName());
            } while (uniqueUsernames.has(username) || username.length < 3);
            
            uniqueUsernames.add(username);
            
            const email = `${username}@matcha.com`;
            const createdAt = faker.date.past().toISOString().slice(0, 19).replace('T', ' ');
            const gender = faker.random.arrayElement(['male', 'female', 'other']);
            const looking = faker.random.arrayElement(['male', 'female', 'other', 'all']);
            const birthdate = faker.date.between('1960-01-01', '2005-12-31').toISOString().slice(0, 10);
            const biography = getRandomBiography();
            const tags = getRandomTags();
            
            const addressIndex = i % addressesLines.length;
            const addressLine = addressesLines[addressIndex];
            const addressParts = addressLine.split(', ');
            
            if (addressParts.length >= 6) {
              const [address, city, countryName, postalCode, lat, lng] = addressParts;
              
              const phone = generatePhoneNumber();
              const vkey = faker.random.alphaNumeric(20);

              users.push({
                id: i,
                firstName, lastName, username, email, createdAt, gender, looking, 
                birthdate, biography, tags, address, city, country: countryName, 
                postalCode, phone, lat, lng, vkey
              });

              // √âchapper les apostrophes pour PostgreSQL
              const escapedBiography = biography.replace(/'/g, "''");
              const escapedTags = tags.replace(/'/g, "''");
              const escapedAddress = address.replace(/'/g, "''");
              const escapedCity = city.replace(/'/g, "''");

              sqlContent += `('${firstName}', '${lastName}', '${username}', '${email}', '${hashedPassword}', '${createdAt}', '${gender}', '${looking}', '${birthdate}', '${escapedBiography}', '${escapedTags}', '${escapedAddress}', '${escapedCity}', '${countryName}', '${postalCode}', '${phone}', '${createdAt}', '${lat}', '${lng}', '${vkey}', true, 0)`;
              
              if (i < userCount) {
                sqlContent += ',\n';
              } else {
                sqlContent += ';\n\n';
              }
            }
          }

          // Insertion des images
          sqlContent += `-- üñºÔ∏è INSERTION DES IMAGES
INSERT INTO images (user_id, name, profile, cover, created_at) VALUES
`;

          let imageCounter = 0;
          const totalImages = userCount * imageCount;
          
          for (let i = 1; i <= userCount; i++) {
            for (let j = 0; j < imageCount; j++) {
              imageCounter++;
              
              const width = (j === 0) ? 1584 : 400;
              const height = (j === 0) ? 396 : 400;
              const imageId = (i * imageCount) + j + 1;
              
              const url = `https://i.pravatar.cc/${width}x${height}?u=user-${imageId}`;
              const createdAt = faker.date.past().toISOString().slice(0, 19).replace('T', ' ');
              const cover = (j === 0) ? 'true' : 'false';
              const profile = (j === 1) ? 'true' : 'false';

              sqlContent += `(${i}, '${url}', ${profile}, ${cover}, '${createdAt}')`;
              
              if (imageCounter < totalImages) {
                sqlContent += ',\n';
              } else {
                sqlContent += ';\n\n';
              }
            }
          }

          // Insertion des tags par d√©faut
          sqlContent += `-- üè∑Ô∏è INSERTION DES TAGS
INSERT INTO tags (value) VALUES
`;
          
          const tagValues = defaultTags.map(tag => `('${tag}')`).join(',\n');
          sqlContent += tagValues + ';\n\n';

          sqlContent += `-- ‚úÖ SCRIPT TERMIN√â AVEC SUCC√àS !
-- üìä R√©sum√©: ${userCount} utilisateurs, ${imageCounter} images, ${defaultTags.length} tags
-- üéØ Pr√™t pour l'import dans Neon.tech !`;
        }

        // Cr√©er et t√©l√©charger le fichier
        const blob = new Blob([sqlContent], { type: 'text/plain; charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `neon_database_${country}_${userCount}users_${new Date().toISOString().split('T')[0]}.sql`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        // Afficher le statut
        document.getElementById('neonStatus').innerHTML = 
          `<div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
            <strong>‚úÖ Fichier g√©n√©r√© avec succ√®s !</strong><br>
            <strong>üì¶ ${userCount} utilisateurs</strong> avec <strong>${imageCount} images</strong> chacun<br>
            <strong>üåç Pays:</strong> ${country}<br>
            <strong>üíæ Taille:</strong> ${Math.round(sqlContent.length / 1024)} KB<br><br>
            <strong>üì• Le t√©l√©chargement a d√©marr√© automatiquement.</strong><br>
            <strong>üöÄ Allez maintenant sur <a href="https://console.neon.tech/app/projects/twilight-truth-83884370" target="_blank">Neon.tech</a> et importez le fichier !</strong>
          </div>`;

      } catch (error) {
        console.error('Erreur lors de la g√©n√©ration:', error);
        document.getElementById('neonStatus').innerHTML = 
          `<div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
            <strong>‚ùå Erreur lors de la g√©n√©ration:</strong> ${error.message}
          </div>`;
      } finally {
        hidePopup();
      }
    }

    function showPopup(message = "‚è≥ Op√©ration en cours...") {
      const popup = document.getElementById("loadingPopup");
      popup.innerHTML = message;
      popup.style.display = "flex";
    }
    
    function hidePopup() {
      document.getElementById("loadingPopup").style.display = "none";
    }
  </script>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" href="./matcha_icon.ico" type="image/x-icon" />
    <title>Matcha-42</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      h1, h2, h3 {
        color: #2c3e50;
      }
      h1 {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3498db;
      }
      h2 {
        margin-top: 40px;
        padding-left: 15px;
        border-left: 4px solid #3498db;
      }
      .form-section {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 30px;
      }
      .neon-section {
        border: 3px solid #4CAF50;
        background: linear-gradient(135deg, #f9fff9 0%, #e8f5e8 100%);
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
      }
      input, select {
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border-color 0.3s;
      }
      input:focus, select:focus {
        outline: none;
        border-color: #3498db;
      }
      button {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }
      .neon-button {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      }
      .instructions {
        background: #e8f4f8;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 4px solid #3498db;
      }
      .status-box {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        border: 2px solid;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .download-link {
        display: inline-block;
        padding: 10px 20px;
        background: #4CAF50;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        margin-top: 10px;
        transition: background 0.3s;
      }
      .download-link:hover {
        background: #45a049;
      }
      pre {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 14px;
        line-height: 1.4;
      }
      .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        align-items: center;
      }
      .form-group {
        flex: 1;
      }
      .checkbox-group {
        display: flex;
        gap: 15px;
        margin: 15px 0;
      }
      .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: normal;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Faker/3.1.0/faker.min.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <h1>üöÄ Bienvenue √† la partie Back-End de Matcha</h1>
    
    <div style="text-align: center; margin-bottom: 40px;">
      <h2>üîó Liens importants</h2>
      <p>
        <a href="https://benelhadj.github.io/Matcha/" target="_blank" style="margin: 0 15px; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 5px;">
          üåê Front-End Matcha
        </a>
        <a href="https://console.neon.tech/app/projects/twilight-truth-83884370" target="_blank" style="margin: 0 15px; padding: 10px 20px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
          üóÑÔ∏è Base de donn√©es Neon
        </a>
      </p>
    </div>

    <div class="form-section">
      <h2>üìã Documentation des Routes API</h2>
      <pre style="font-weight: bold;">
*  (POST): http://localhost:3000/login ============> Connectez-vous avec les informations d'identification fournies dans le corps de la requ√™te.
*  (GET) : http://localhost:3000/logout ===========> D√©connectez-vous de votre session utilisateur.
*  (GET) : http://localhost:3000/isLoggedin =======> V√©rifiez si l'utilisateur est connect√©.
*  (POST): http://localhost:3000/forget_password ==> Envoyez une demande de r√©initialisation de mot de passe avec les informations fournies dans le corps de la requ√™te.
*  (GET) : http://localhost:3000/recover/:key =====> R√©cup√©rez la page de r√©cup√©ration de mot de passe avec la cl√© fournie dans l'URL.
*  (POST): http://localhost:3000/rkeycheck ========> V√©rifiez si la cl√© de r√©cup√©ration de mot de passe fournie dans le corps de la requ√™te est valide.
*  (GET) : http://localhost:3000/destroykey =======> D√©truisez la cl√© de r√©cup√©ration de mot de passe.
*  (GET) : http://localhost:3000/history ==========> Obtenez l'historique de navigation de l'utilisateur connect√©.
*  (GET) : http://localhost:3000/tags =============> Obtenez les tags de l'utilisateur connect√©
*  (GET) : http://localhost:3000/allTags ==========> Obtenez les toutes les tags disponibles.
*  (GET) : http://localhost:3000/all ==============> Obtenez toutes les conversations de chat de l'utilisateur connect√©.
*  (POST): http://localhost:3000/messages =========> Obtenez les messages d'une conversation sp√©cifique avec l'identifiant de conversation fourni dans le corps de la requ√™te.
*  (POST): http://localhost:3000/update ===========> Mettez √† jour les informations d'une conversation sp√©cifique avec l'identifiant de conversation et les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/send =============> Envoyez un message dans une conversation sp√©cifique avec l'identifiant de conversation et le message fournis dans le corps de la requ√™te.
*  (POST): http://localhost:3000/match ============> Effectuez un matching entre l'utilisateur connect√© et d'autres utilisateurs.
*  (GET) : http://localhost:3000/getmatches =======> Obtenez les correspondances de l'utilisateur connect√©.
*  (POST): http://localhost:3000/add ==============> Ajoutez une notification de chat avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/update ===========> Mettez √† jour une notification avec les informations fournies dans le corps de la requ√™te.
*  (GET) : http://localhost:3000/all ==============> Obtenez toutes les notifications de l'utilisateur connect√©.
*  (POST): http://localhost:3000/add ==============> Ajoutez un utilisateur avec les informations fournies dans le corps de la requ√™te.
*  (GET) : http://localhost:3000/verify/:key ======> V√©rifiez l'adresse e-mail de l'utilisateur avec la cl√© fournie dans l'URL.
*  (POST): http://localhost:3000/updateprofile ====> Mettez √† jour le profil de l'utilisateur connect√© avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/changeemail ======> Changez l'adresse e-mail de l'utilisateur connect√© avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/changepassword ===> Changez le mot de passe de l'utilisateur connect√© avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/show =============> Obtenez la liste des utilisateurs correspondant aux crit√®res de recherche fournis dans le corps de la requ√™te.
*  (GET) : http://localhost:3000/show/:id =========> Obtenez les informations d'un utilisateur sp√©cifique avec l'identifiant d'utilisateur fourni dans l'URL.
*  (POST): http://localhost:3000/report ===========> Signalez un utilisateur avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/block ============> Bloquez un utilisateur avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/unblock ==========> D√©bloquez un utilisateur avec les informations fournies dans le corps de la requ√™te.
*  (GET) : http://localhost:3000/getblocked =======> Obtenez la liste des utilisateurs bloqu√©s par l'utilisateur connect√©.
*  (POST): http://localhost:3000/blacklisted ======> Ajoutez un utilisateur √† la liste noire de l'utilisateur connect√© avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/location =========> Mettez √† jour la localisation de l'utilisateur connect√© avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/image ============> Ajoutez une image √† la galerie de l'utilisateur connect√© avec le fichier image fourni dans le corps de la requ√™te.
*  (POST): http://localhost:3000/image/cover ======> Ajoutez une image de couverture √† l'utilisateur connect√© avec le fichier image fourni dans le corps de la requ√™te.
*  (POST): http://localhost:3000/image/del ========> Supprimez une image de la galerie de l'utilisateur connect√© avec les informations fournies dans le corps de la requ√™te.
*  (POST): http://localhost:3000/get_last_user_id => r√©cup√©rer la dernier Id d'utilisateur.
      </pre>
    </div>

    <!-- SECTION ORIGINALE : Cr√©ation d'utilisateurs pour MySQL -->
    <div class="form-section">
      <h2>üë• Cr√©ation d'utilisateurs et d'images al√©atoires (MySQL)</h2>
      <form id="userCreationForm">
        <div class="form-row">
          <div class="form-group">
            <label for="userCount">Nombre d'utilisateurs √† cr√©er (max 500) :</label>
            <input type="number" id="userCount" name="userCount" min="1" max="500" value="50" required>
          </div>

          <div class="form-group">
            <label for="imageCount">Nombre d'images par utilisateur (max 5) :</label>
            <input type="number" id="imageCount" name="imageCount" min="1" max="5" value="5" required>
          </div>

          <div class="form-group">
            <label for="countrySelect">S√©lectionnez un pays :</label>
            <select id="countrySelect" name="countrySelect">
              <option value="France" countryName="fr">France</option>
              <option value="Italie" countryName="it">Italie</option>
              <option value="Germany" countryName="de">Allemagne</option>
              <option value="Pays-Bas" countryName="nl">Pays-Bas</option>
              <option value="Espagne" countryName="es">Espagne</option>
            </select>
          </div>
        </div>

        <button type="submit" style="display: block; margin: 20px auto;">Cr√©er des utilisateurs et des images</button>
      </form>

      <p id="status"></p>
    </div>

    <!-- NOUVELLE SECTION : G√©n√©ration pour Neon.tech -->
    <div class="form-section neon-section">
      <h2>üöÄ G√©n√©ration de Base de Donn√©es pour Neon.tech</h2>
      <h3>G√©n√©rer un fichier SQL compatible PostgreSQL (Neon)</h3>
      
      <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
        <div class="form-row">
          <div class="form-group">
            <label for="neonUserCount">Nombre d'utilisateurs √† cr√©er :</label>
            <input type="number" id="neonUserCount" name="neonUserCount" min="1" max="1000" value="50" style="width: 120px;">
          </div>

          <div class="form-group">
            <label for="neonImageCount">Images par utilisateur :</label>
            <input type="number" id="neonImageCount" name="neonImageCount" min="1" max="5" value="5" style="width: 120px;">
          </div>

          <div class="form-group">
            <label for="neonCountry">Pays pour les adresses :</label>
            <select id="neonCountry" name="neonCountry" style="width: 200px;">
              <option value="France">France</option>
              <option value="Italy">Italie</option>
              <option value="Germany">Allemagne</option>
              <option value="Spain">Espagne</option>
              <option value="Netherlands">Pays-Bas</option>
            </select>
          </div>
        </div>

        <div class="checkbox-group">
          <label>
            <input type="checkbox" id="includeTables" name="includeTables" checked>
            Inclure la cr√©ation des tables
          </label>
          <label>
            <input type="checkbox" id="includeData" name="includeData" checked>
            Inclure les donn√©es (utilisateurs + images)
          </label>
        </div>

        <button type="button" onclick="generateNeonSQL()" class="neon-button" style="padding: 15px 30px; font-size: 18px;">
          üéØ G√©n√©rer le SQL pour Neon
        </button>
      </div>

      <div id="neonStatus" style="margin-top: 20px;"></div>

      <div class="instructions">
        <h4>üìã Instructions pour Neon.tech :</h4>
        <ol>
          <li>Cliquez sur <strong>"G√©n√©rer le SQL pour Neon"</strong></li>
          <li>T√©l√©chargez le fichier <strong>.sql g√©n√©r√©</strong></li>
          <li>Allez sur <a href="https://console.neon.tech/app/projects/twilight-truth-83884370" target="_blank" style="color: #4CAF50; font-weight: bold;">votre projet Neon</a></li>
          <li>Cliquez sur <strong>"SQL Editor"</strong> dans la sidebar</li>
          <li>Copiez-collez le <strong>contenu du fichier SQL</strong></li>
          <li>Ex√©cutez le script ! üéâ</li>
        </ol>
        <p><strong>‚ú® Le fichier inclut automatiquement :</strong></p>
        <ul>
          <li>Cr√©ation des tables (si coch√©)</li>
          <li>Insertion des utilisateurs avec donn√©es r√©alistes</li>
          <li>Insertion des images avec URLs Pravatar</li>
          <li>Formatage PostgreSQL 100% compatible</li>
          <li>Relations et contraintes de cl√©s √©trang√®res</li>
        </ul>
      </div>
    </div>

    <script>
      // Script original pour la g√©n√©ration MySQL
      document.getElementById('userCreationForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        showPopup("‚è≥ Cr√©ation des utilisateurs MySQL en cours...");

        try {
          const salt = dcodeIO.bcrypt.genSaltSync(10);

          const addressesData = await readAddressesFile();
          const addressesLines = addressesData.split('\n');

          const userCount = document.getElementById('userCount').value;
          const imageCount = document.getElementById('imageCount').value;
          const sqlFileName = document.getElementById('countrySelect').value + 'BDD';
          const selectedCountry = document.getElementById('countrySelect').value;

          function cleanString(input) {
            var output = input.replace(/[^\w\s]/gi, '');
            return output;
          }

          const defaultTags = ['Ecole-42-Paris', 'Validate-at-125', 'RNCP-5', 'RNCP-7', 'Development', 'Front-end', 'Back-end', 'Sports', 'Cinema', 'Music', 'Vegan', 'Geek', 'Piercing', 'Tattoos'];
          const defaultBiography = ['je suis timide', 'j aime la techno', 'Perdu mais aimant', 'J aime le tennis de table', 'Tendre, je cherche une relation serieuse', 'Ici pour vous faire rever',
          'Je cherche mon ame soeur', 'je suis bavard', 'j adore la musique pop', 'je suis un peu fou', 'je suis un peu folle', 'je suis un peu foufou', 'je suis un peu folle dingue', 'je suis un peu foufou dingue',
          'l amour est mon essentiel', 'j aime la vie', 'rugbymen et le physique qui va avec', 'je suis un rockeur', 'fan de johnny hallyday', 'j aime les danses de salon', 'je suis loyale', 'je suis fidele','je suis honnete',
          'je suis sincere', 'je suis franc', 'fidele en amour et en amitie', 'je suis un peu jaloux', 'je suis un peu jalouse', 'je suis un peu jaloux jalouse possessif possessive', 'ici pour chercher l amour comme vous',
          'je chercher un plaisir temporaire', 'je suis un peu coquin', 'je suis un peu coquine', 'parlez moi je reponds a tout le monde', 'je vous attends avec impatience', 'toujours au taquet', 'j aime la nature et les femmes',
          'j aime la nature et les hommes', 'ma vie c est toi', 'sea sex and sun', 'je suis un peu timide mais je me soigne', 'je cherche le grand amour', 'je cherche l amour', 'je cherche l amitie', 'je cherche des amis',
          'je cherche des amies', 'je cherche des amis et des amies', 'je cherche des amis et des amies pour sortir et plus si affinites', 'rappeur depuis dix ans, je mets l ambiance', 'je suis fetard', 'je suis fetarde',
          'je suis calme et casanier', 'je suis calme et casaniere', 'je suis calme et casanier casaniere mais j aime sortir de temps en temps', 'geek mais sociable et j aime sortir','perfectionnsite mais facile a vivre',
          'idealiste en depit de ce monde', 'je suis polygame et je cherche des femmes qui acceptent cela', 'je sors d une relation douloureuse', 'je prefere les femmes grandes', 'je prefere les femmes petites', 'j aime les hommes muscles',
          'cherche une femme pleine de vie', 'cherche un homme plein de vie', 'je suis naturel', 'je suis naturel naturelle et je cherche une personne naturelle', 'je suis naturel naturelle et je cherche une personne naturelle et simple et qui aime la vie',];

          function getRandomTags() {
            const pickaxe = [...defaultTags];
            const randomTags = [];
            for (let i = 0; i < 4; i++) {
              const randomIndex = Math.floor(Math.random() * pickaxe.length);
              randomTags.push(pickaxe[randomIndex]);
              pickaxe.splice(randomIndex, 1);
            }
            return randomTags.join(', ');
          }

          function getRandomBiography() {
            const pickaxe = [...defaultBiography];
            const randomTags = [];
            for (let i = 0; i < 3; i++) {
              const randomIndex = Math.floor(Math.random() * pickaxe.length);
              randomTags.push(pickaxe[randomIndex]);
              pickaxe.splice(randomIndex, 1);
            }
            return randomTags.join(', ');
          }

          function generatePhoneNumber() {
            const firstDigit = '0';
            const secondDigit = (Math.floor(Math.random() * 9) + 1).toString();
            const randomDigits = Array.from({ length: 8 }, () => Math.floor(Math.random() * 10)).join('');
            return firstDigit + secondDigit + randomDigits;
          }

          let sql = 'INSERT INTO `users` (`id`, `first_name`, `last_name`, `username`, `email`, `password`, `created_at`, `gender`, `looking`, `birthdate`, `biography`, `tags`, `address`, `city`, `country`, `postal_code`, `phone`, `status`, `lat`, `lng`, `vkey`, `rkey`, `verified`, `google_id`, `reports`) VALUES\n';
    
          const uniqueUsernames = new Set();
          try {
            let id = await getLastUserId() + 1;
            for (let i = 0; i < userCount; i++) {

              let firstName, lastName, username;
              do {
                username = cleanString(faker.internet.userName());
              } while (uniqueUsernames.has(username));

              do {
                firstName = cleanString(faker.name.firstName());
                lastName = cleanString(faker.name.lastName());
              } while (!(/^[a-zA-Z \-]+$/).test(firstName) || !(/^[a-zA-Z \-]+$/).test(lastName) || firstName.length < 3 || firstName.length > 25 || lastName.length < 3 || lastName.length > 25);
            
              do {
                username = cleanString(faker.internet.userName());
              } while (uniqueUsernames.has(username) || !(/^[a-zA-Z0-9]+$/).test(username) || username.length < 7 || username.length > 25);
            
              uniqueUsernames.add(username);
              const email = `${username}@matcha.com`;

              const password = dcodeIO.bcrypt.hashSync('Motdepasse@123', salt);

              const createdAt = faker.date.past().toISOString().slice(0, 19).replace('T', ' ');
              const gender = faker.random.arrayElement(['male', 'female', 'other']);
              const looking = faker.random.arrayElement(['male', 'female', 'other', 'all']);
              const birthdate = faker.date.between('1960-01-01', '2005-12-31').toISOString().slice(0, 10);
              const biography = getRandomBiography();
              const tags = getRandomTags();

              const [address, city, country, postal_code, lat, lng] = addressesLines[i % addressesLines.length].split(', ');

              const phone = generatePhoneNumber();

              const status = createdAt;
              const vkey = faker.random.alphaNumeric(20);
              const rkey = null;
              const verified = 1;
              const google_id = null;
              const reports = 0;

              sql += `('${id + i}', '${firstName}', '${lastName}', '${username}', '${email}', '${password}', '${createdAt}', '${gender}', '${looking}', '${birthdate}', '${biography}', '${tags}', '${address}', '${city}', '${country}', '${postal_code}', '${phone}', '${status}', '${lat}', '${lng}', '${vkey}', '${rkey}', '${verified}', '${google_id}', '${reports}'),\n`;
            } 
          } catch (error) {
            console.error("INSERT INTO users ===> √âchec de la r√©cup√©ration du dernier user_id :", error);
          }

          sql = sql.slice(0, -2) + ';\n\n';

          sql += 'INSERT INTO `images` (`user_id`, `name`,`profile`,`cover`,`created_at`) VALUES\n';

          try {
            let user_id = await getLastUserId();
            let userId = user_id + 1;

            for (let i = 0; i < userCount; i++) {
              for (let j = 0; j < imageCount; j++) {
                const width = (j === 0) ? 1584 : 400;
                const height = (j === 0) ? 396 : 400;
                const imageId = (userId * imageCount) + j + user_id + 1;
                const url = `https://i.pravatar.cc/${width}x${height}?u=user-${imageId}`;
                const createdAt = faker.date.past().toISOString().slice(0, 19).replace('T', ' ');
                const cover = (j === 0) ? '1' : '0';
                const profile = (j === 1) ? '1' : '0';

                sql += `('${userId}', '${url}','${profile}','${cover}', '${createdAt}'),\n`;
              }
              userId++;
            }
          } catch (error) {
            console.error("INSERT INTO images ===> √âchec de la r√©cup√©ration du dernier user_id :", error);
          }

          sql = sql.slice(0, -2) + ';';

          const blob = new Blob([sql], {type: 'text/plain'});
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = sqlFileName + '.sql';
          link.click();
          
          document.getElementById('status').innerHTML = 
            `<div class="status-box success">
              ‚úÖ Fichier ${sqlFileName}.sql g√©n√©r√© avec succ√®s !
            </div>`;
            
      } catch (error) {
        console.error("üö® Erreur lors de la cr√©ation :", error);
        document.getElementById('status').innerHTML = 
          `<div class="status-box error">
            ‚ùå Erreur: ${error.message}
          </div>`;
      } finally {
        hidePopup();
      }
      });
    </script>

    <div id="loadingPopup" style="
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      flex-direction: column;
      gap: 20px;">
      <div>‚è≥ Op√©ration en cours...</div>
      <div style="font-size: 16px; color: #ccc;">Veuillez patienter</div>
    </div>
  </body>
</html>